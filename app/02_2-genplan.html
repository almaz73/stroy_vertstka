<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Царёво Village</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.3/dist/leaflet.css"/>
    <script src="https://npmcdn.com/leaflet@1.0.3/dist/leaflet.js"></script>
</head>
<body>

<div class="page">
    <div class="b-header">
        <a href="#" onclick="history.go(-1)"><span class="b-header_arrow hide_"><img src="images/arrow_line_left.png"/></span></a>
        <img class="b-header_leaf" src="images/leaf_white.png">
        <img class="b-header_logo" src="images/logo_white.png">
        <a href="01_3-меню.html"><span class="b-header_button on"></span></a>
    </div>

    <div class="b-title-duck">
        <span class="b-title-duck_span"></span>
        <span class="b-title-duck_text">Подобрать квартиру</span>
        <img class="b-title-duck_img" src="images/duck.png">
    </div>


    <div class="b-filter">
        <span class="b-filter_buttons">
            <span class="b-filter_buttons_on">Генплан</span><a href="03_planirovki.html"><span
                class="b-filter_buttons_off">
                Планировки</span></a>
        </span>
        <span class="b-filter_opener" onclick="document.location ='05_список-квартир.html?filter'">
            <img src="images/filter.png">
        </span>

    </div>

    <div id='leafletmap'>
        <div class="leaflet-control">
            <button onclick="plusMinus(-1)">
                <img src="images/minus.png"/>
            </button>
            <button onclick="plusMinus(1)">
                <img src="images/plus.png"/>
            </button>
            <div class="leaflet-zoom">
                <div class="leaflet-zoom-boat"></div>
            </div>
        </div>
    </div>


    <img class="b-unistroy" src="images/unistroy.png">

    <div class="b-copyriht">&copy; 2017. Царёво Village</div>

</div>

<script>
   'use strict';
   var map,
      maxBounds = [
         [-140.625, 0],
         [0, 250]
      ],
      mapInitZoom = 3,
      map_w = 8000,
      map_h = 2800,
      map_z = 5,
      maxZoom = 6;


   map = L.map ('leafletmap', {
      editable: true,
      maxZoom: maxZoom,
      minZoom: 3,
      crs: L.CRS.Simple,
      pin: true,
      maxBounds: maxBounds,
      pinCircle: true,
      pinControl: true,
      guideLayers: [],
      scrollWheelZoom: true
   });

   function plusMinus (val) {
      var currentZoom = map.getScaleZoom (1);
      map.setZoom (currentZoom + val);
   }

   // настривание ползунка
   map.on ('moveend', function (e) {
      var mapBoundX = 1999; // ширина генплана
      var widthDiv = 270; // ширина поля указателя зума
      var div = document.getElementsByClassName ('leaflet-zoom-boat')[0];
      var Bounds = map.getPixelBounds ();

      var minX = Bounds.min.x;
      var maxX = Bounds.max.x;
      var zoom = map.getScaleZoom (1);
      var scale = 1;
      if (zoom == 3) scale = 1;
      if (zoom == 4) scale = 2;
      if (zoom == 5) scale = 4;
      if (zoom == 6) scale = 8;
      var left = widthDiv * minX / mapBoundX / (scale);
      var width = (maxX - minX) * widthDiv / mapBoundX / (scale);

      div.style.width = (width - 2) + "px";
      div.style.left = left + "px";
   });

   var LeafIcon = L.Icon.extend ({});
   var myIcon = new LeafIcon ({iconUrl: 'images/marker-infrastructure.png'});

   // добавлены указатели
   L.marker ([-50, 130], {icon: myIcon}).addTo (map);
   L.marker ([-40, 110], {icon: myIcon}).addTo (map);
   L.marker ([-45, 115], {icon: myIcon}).addTo (map);


   // добавлен полигон
   var latlngs = [[-58.578125, 94.828125], [-60.828125, 94.9375], [-68.78125, 108.171875], [-65.1875, 125.78125], [-62.734375, 125.828125], [-56.140625, 111.5]];
   var polygon = L.polygon (latlngs, {color: 'red'}).addTo (map);
   map.fitBounds (polygon.getBounds ());

   // tile layer
   L.tileLayer ('http://tsarevodom.ru/tiles/{z}-{x}-{y}.jpg', {}).addTo (map);
   map.setView (map.unproject ([map_w / 2, map_h / 2], map_z), mapInitZoom);


</script>
</body>
</html>