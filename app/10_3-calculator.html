<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="calc.css">
</head>
<body>

<div class="page">
    <div class="b-header">
        <div class="b-header_arrow hide"><a href="#" onclick="history.go(-1)"><img src="images/arrow_line_left.png"/></a></div>
        <img class="b-header_leaf" src="images/leaf_white.png">
        <img class="b-header_logo" src="images/logo_white.png">
        <a href="01_3-меню.html"><span class="b-header_button on"/></a>
    </div>


    <div class="b-title-bird2">
        <span class="b-title-bird2_span"></span>
        <span class="b-title-bird2_text">Ипотека</span>
        <img class="b-title-bird2_img" src="images/bird.png">
    </div>

    <div class="b-trigger">
        <div class="b-trigger_off"><a href="10_1-banks.html">Банки- партнёры</a></div>
        <div class="b-trigger_on">Ипотечный калькулятор</div>
    </div>


    <div class="calc">
        <label>стоимость квартиры<label class="label_after">₽</label></label>
        <input id="cost" onkeyup="toCost(event)"/>

        <label>первоначальный взнос<label class="label_after">₽</label></label>
        <input id="cost2" onkeyup="toContribution(event)"/>
        <div class="calc_buttons">
            <div onclick="toContributionButton(event)">10%</div>
            <div onclick="toContributionButton(event)">15%</div>
            <div onclick="toContributionButton(event)">20%</div>
            <div onclick="toContributionButton(event)">25%</div>
            <div onclick="toContributionButton(event)">30%</div>
            <div onclick="toContributionButton(event)">35%</div>
            <div onclick="toContributionButton(event)">40%</div>
        </div>
        <label>срок ипотеки<label class="label_after">мес</label></label>
        <input id="months" onkeyup="toYear(event)"/>
        <div class="calc_buttons">
            <div onclick="toYearButton(event)">3<br>года</div>
            <div onclick="toYearButton(event)">5<br>года</div>
            <div onclick="toYearButton(event)">7<br>года</div>
            <div onclick="toYearButton(event)">10<br>года</div>
            <div onclick="toYearButton(event)">15<br>года</div>
            <div onclick="toYearButton(event)">20<br>года</div>
            <div onclick="toYearButton(event)">25<br>года</div>
            <div onclick="toYearButton(event)">30<br>года</div>
        </div>
        <label>процентная вставка<label class="label_after">%</label></label>
        <input id="percent" onkeyup="toPersent(event)"/>
    </div>

    <div class="calc-total">
        <p>Ежемесячный платёж</p>
        <div>
            <span id="monthlyPayment">0</span> ₽
        </div>
    </div>
    <div class="calc-apply">
        <p><b>Сумма кредита <span id="credit">0</span> ₽</b></p>
        <div class="apply-button">
            <a href="javascript:alert()"> Оставить заявку</a>
        </div>
        <p class="little">Рассчет предварительный, необходимо уточнить у менеджеров</p>
    </div>


    <img class="b-unistroy" src="images/unistroy.png">

    <div class="b-copyriht">&copy; 2017. Царёво Village</div>

    <script>
       'use strict';
       var year = 0,
          cost_flat = 0,
          contribution = 0,
          months = 0,
          interestRate = 0,

          monthlyPayment = 0,
          credit = 0;

       function toContributionButton (event) {
          contribution = cost_flat * parseInt (event.target.innerText) / 100;
          document.getElementById ("cost2").value = contribution.toLocaleString ("ru");
          toCalc ()
       }

       function toContribution (event) {
          contribution = parseInt (event.target.value.replace (/\s+/g, ""));
          if (isNaN (contribution)) document.getElementById ("cost2").value = ""
          if (contribution) document.getElementById ("cost2").value = contribution.toLocaleString ("ru")
          toCalc ()
       }

       function toCost (event) {
          cost_flat = parseInt (event.target.value.replace (/\s+/g, ""));
          if (isNaN (cost_flat)) document.getElementById ("cost").value = ""
          if (cost_flat) document.getElementById ("cost").value = cost_flat.toLocaleString ("ru")
          toCalc ()
       }


       function toYear (event) {
          months = parseInt (event.target.value);
          if (isNaN (months)) months = "";
          year = months / 12;
          document.getElementById ("months").value = months;
          toCalc ()
       }

       function toYearButton (event) {
          year = parseInt (event.target.innerText);
          months = year * 12
          document.getElementById ("months").value = months;
          toCalc ()
       }

       function toPersent (event) {
          interestRate = parseInt (event.target.value);
          if (isNaN (interestRate)) interestRate = "";
          document.getElementById ("percent").value = interestRate;
          toCalc ()
       }


       function toCalc () {
          credit = cost_flat - contribution;
          document.getElementById ("credit").innerText = credit;

          var S = credit;
          var p = interestRate;
          var n = year;

          p = p / 1200;
          n = n * 12;

          if (
             n === 0 ||
             p === 0
          ) return;

          var res = (S * p / (1 - Math.pow (1 + p, -n))).toFixed (2);

          monthlyPayment = parseInt (res);
          document.getElementById ("monthlyPayment").innerText = monthlyPayment;

       }
    </script>
</div>
</body>
</html>